<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>修改合同</title>
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<link rel="stylesheet" type="text/css"
	href="${ctx}/easyui/themes/default/easyui.css">
<link rel="stylesheet" type="text/css"
	href="${ctx}/easyui/themes/icon.css">
<script type="text/javascript" src="${ctx}/easyui/jquery.min.js"></script>
<script type="text/javascript" src="${ctx}/easyui/jquery.easyui.min.js"></script>
<script type="text/javascript" src="${ctx}/easyui/locale/easyui-lang-zh_CN.js"></script>
<script type="text/javascript" src="${ctx}/js/jquery/jTemplates/jquery-jtemplates.js"></script>
<script type="text/javascript" src="${ctx}/js/common/contract.js"></script>
<script>
var path="";
var editIndex = undefined;
//行处理
function endEditing() {
	if (editIndex == undefined) {
		return true
	}
	if ($('#dg').datagrid('validateRow', editIndex)) {
		var ed = $('#dg').datagrid('getEditor', {
			index : editIndex,
			field : 'productid'
		});
		var productname = $(ed.target).combobox('getText');
		$('#dg').datagrid('getRows')[editIndex]['productname'] = productname;
		$('#dg').datagrid('endEdit', editIndex);
		editIndex = undefined;
		return true;
	} else {
		return false;
	}
}
//点击行
function onClickRow(index) {
	if (editIndex != index) {
		if (endEditing()) {
			$('#dg').datagrid('selectRow', index).datagrid(
					'beginEdit', index);
			editIndex = index;
		} else {
			$('#dg').datagrid('selectRow', editIndex);
		}
	}
}
//添加行
function append() {
	if (endEditing()) {
		$('#dg').datagrid('appendRow', {
			status : 'P'
		});
		editIndex = $('#dg').datagrid('getRows').length - 1;
		$('#dg').datagrid('selectRow', editIndex).datagrid(
				'beginEdit', editIndex);
	}
}
//移除行
function removeit() {
	if (editIndex == undefined) {
		return
	}
	$('#dg').datagrid('cancelEdit', editIndex).datagrid(
			'deleteRow', editIndex);
	editIndex = undefined;
}
//添加行
function appendtr() {
		$("#dg")
				.append(
						"<tr>"
								+ "<td><input name='index' style='width: 20px; height: 20px' type='checkbox' /></td>"
								+ "<td><input type='text' name='materielNo' style='width: 30px;' readonly='readonly' /></td>"
								+ "<td><select style='width: 100%; height: 25px' name='silicon'> <option value='单晶'>单晶</option> <option value='多晶'>多晶</option> <option value='PERC'>PERC</option></select></td>"
								+ "<td><select style='width: 100%; height: 25px' name='mainGrid'> <option value='四主栅'>四主栅</option> <option value='五主栅'>五主栅</option> </select></td>"
								+ "<td><select style='width: 100%; height: 25px' name='tech'> <option value='1'>1</option> <option value='2'>2</option> </select></td>"
								+ "<td><input type='number' name='convertRate' style='width: 100px;' required="+"'required'/></td>"
								+ "<td><select style='width: 100%; height: 25px' name='grade'> <option value='A级'>A级</option> <option value='B级'>B级</option><option value='C级'>C级</option></select></td>"
								+ "<td><input type='number' name='mount' style='width: 100px;'  required="+"'required' /></td>"
								+ "<td><select style='width: 100px; height: 25px'  name='unit'> <option>W</option> <option>PC</option> </select></td>"
								+ "<td><input type='text' onkeyup='clearNoNum(this)' name='unitCost' style='width: 100px;'  required="+"'required' onblur='calSum(this)'></td>"
								+ "<td><input type='number' name='sum' style='width: 120px;'  required="+"'required' readonly></td>"
								+ "<td><input type='text' name='deliveryState' style='width: 80px;' value='未执行' readonly='readonly'></td>"
								+ "<td><input type='text' name='billState' style='width: 80px;' value='未执行' readonly='readonly'></td>"
								+ "<td><input type='hidden' name='contractDetailId' value='ooo'></td>"
								+ "</tr>")
		var len = $("#dg tr").length
		for (var i = 2; i < len; i++) {
			$("#dg tr:eq(" + i + ")").find("input[name='materielNo']").val(($(this).index() + i) * 10)
			/* var mount = $("#dg tr:eq(" + i + ")").find("input[name='mount']").val()	
			var unitCost = $("#dg tr:eq(" + i + ")").find("input[name='unitCost']").val()
			$("#dg tr:eq(" + i + ")").find("input[name='sum']").val(new Number(mount) * new Number(unitCost)) */
		}
	}
//添加计划行
function appendtr1() {
		$("#dg1")
				.append(
						"<tr>"
								+ "<td><input name='index1' style='width: 20px; height: 20px' type='checkbox' /></td>"
								+ "<td><input type='number' name='contractItem' style='width: 50px;' required="+"'required'/></td>"
								+ "<td><input type='number' name='planNo' style='width: 50px;' required="+"'required'/></td>"
								+ "<td><input type='date' name='planDate' style='width:120px' required="+"'required'></td>"
								+ "<td><input type='text' onclick='getbiaodi()' name='materielNo' style='width:80px'  readonly='readonly'></td>"
								+ "<td><input type='text' name='materielDes' style='width:130px' readonly='readonly'></td>"
								+ "<td><input type='number' name='mount' id='mount' style='width: 100px;' required="+"'required'/></td>"
								+ "<td><select style='width: 100px;' name='unit'> <option value='W'>W</option> <option value='PC'>PC</option></select></td>"
								+ "<td><input type='number' step='0.01' id='unitPrice' name='unitPrice' style='width: 100px;'  required="+"'required' /></td>"
								+ "<td><input type='number' step='0.01' name='sum' style='width: 100px;'  required="+"'required' readonly></td>"
								+ "<td><input type='text' name='salesOrderNo' style='width: 100px;'  required="+"'required' /></td>"
								+ "<td><input type='text' name='deliveryOrderNo' style='width: 100px;'  required="+"'required'></td>"
								+ "<td><input type='hidden' name='contractDetailId' value='ooo'></td>"
								+ "</tr>")
			$("#mount").bind("input propertychange change",function(event){
				var mount = $(this).parent().parent().find("input[name='mount']").val()
				var unitPrice = $(this).parent().parent().find("input[name='unitPrice']").val()
				$(this).parent().parent().find("input[name='sum']").val(mount*unitPrice)
			})
			$("#unitPrice").bind("input propertychange change",function(event){
				var mount = $(this).parent().parent().find("input[name='mount']").val()
				var unitPrice = $(this).parent().parent().find("input[name='unitPrice']").val()
				$(this).parent().parent().find("input[name='sum']").val(mount*unitPrice)
			})
}
//获取标的
function getbiaodi(){
	$.messager.alert(9)
}
//获取计划
function queplan(){ //jquery获取复选框值 
	var chk_value =[]; 
	var cid = ""
	$('input[name="index"]:checked').each(function(){ 
		chk_value.push($(this).val()); 
		cid = $(this).parent().parent().find("input[name='contractDetailId']").val()
	}); 
	if(chk_value.length==0){
		$.messager.alert("提示","请选择1个合同标的")
	}else if(chk_value.length>1){
		$.messager.alert("提示","只能选择1个合同标的")
	}else{
		//$.messager.alert("标的id",cid)  //发送合同标的id
		//$('#dg1').empty()
		$("#dg1 tr").eq(1).nextAll().empty()
		$.ajax({
			type:'get',
			url:'${ctx}/pact/getfalseplan1',
			cache:true,	
			success:function(data){
				//alert(data.length)
				for(var i=0; i<data.length; i++){
					$('#dg1').append("<tr>"
							+ `"<td><input name='index1' style='width: 20px; height: 20px' type='checkbox' /></td>"`
							+ `"<td><input type='text' value='${data[i].contractItem}' name='contractItem' style='width: 50px;' readonly /></td>"`
							+ `"<td><input type='number' value='${data[i].planNo}' name='planNo' style='width: 50px;' readonly/></td>"`
							+ `"<td><input type='text' name='planDate' style='width:120px' readonly></td>"`
							+ `"<td><input type='text' value='${data[i].materielNo}' name='materielNo' style='width:80px'  readonly='readonly'></td>"`
							+ `"<td><input type='text' value='${data[i].materielDes}' style='width:130px' readonly='readonly'></td>"`
							+ `"<td><input type='number' value='${data[i].mount}' name='mount' id='mount' style='width: 100px;' required="+"'required'/></td>"`
							+ `"<td><select style='width: 100px;' name='unit'> <option value='W'>W</option> <option value='PC'>PC</option></select></td>"`
							+ `"<td><input type='number' value='${data[i].unitPrice}' step='0.01' id='unitPrice' name='unitPrice' style='width: 100px;'  required="+"'required' /></td>"`
							+ `"<td><input type='number' value='${data[i].sum}' step='0.01' name='sum' style='width: 100px;'  required="+"'required' readonly></td>"`
							+ `"<td><input type='text' value='${data[i].salesOrderNo}' name='salesOrderNo' style='width: 100px;'  required="+"'required' /></td>"`
							+ `"<td><input type='text' value='${data[i].deliveryOrderNo}' name='deliveryOrderNo' style='width: 100px;'  required="+"'required'></td>"`
							+ `"<td><input type='hidden' name='contractDetailId' value='ooo'></td>"`
							+ "</tr>")
					$("input[name='planDate']").val(formatDate(data[i].planDate))
					$("#mount").bind("input propertychange change",function(event){
				var mount = $(this).parent().parent().find("input[name='mount']").val()
				var unitPrice = $(this).parent().parent().find("input[name='unitPrice']").val()
				$(this).parent().parent().find("input[name='sum']").val(mount*unitPrice)
				})
				$("#unitPrice").bind("input propertychange change",function(event){
				var mount = $(this).parent().parent().find("input[name='mount']").val()
				var unitPrice = $(this).parent().parent().find("input[name='unitPrice']").val()
				$(this).parent().parent().find("input[name='sum']").val(mount*unitPrice)
				})
				}
			}
		}) 
	}
} 
//移除行
function removeit() {
	$.messager.confirm('警告框', '确定删除?', function(r){
		if (r){
			var ids = new Array()
			$("input[name='index']:checked").each(function() { // 遍历选中的checkbox
				var id = $(this).parents("tr").find("input[name='contractDetailId']").val()
				ids.push(id)
				n = $(this).parents("tr").index(); // 获取checkbox所在行的顺序
				$("#dg").find("tr:eq(" + n + ")").remove();
			});
			$.ajax({
				type: 'POST',
				data: {'ids':ids},
				dataType: 'json',
				url: '${ctx}/detail/deleteDetail',
				success: function (data) {
					console.log(data)
				}
			})
		}
	});
	
}
//移除行
function removeit1() {
	$.messager.confirm('警告框', '确定删除?', function(r){
		if (r){
			var ids = new Array()
			$("input[name='index1']:checked").each(function() { // 遍历选中的checkbox
				var id = $(this).parents("tr").find("input[name='contractDetailId']").val()
				ids.push(id)
				n = $(this).parents("tr").index(); // 获取checkbox所在行的顺序
				$("#dg1").find("tr:eq(" + n + ")").remove();
			});
			/* $.ajax({
				type: 'POST',
				data: {'ids':ids},
				dataType: 'json',
				url: '${ctx}/detail/deleteDetail',
				success: function (data) {
					console.log(data)
				}
			}) */
		}
	});
	
}
//下载文件
function downloadfile(path,fileName){
	 var url = "${ctx}/test/showPactDown";
	 var form = $("<form></form>").attr("action", url).attr("method", "post");
	 form.append($("<input></input>").attr("type", "hidden").attr("name", "path").attr("value", path));
	 form.append($("<input></input>").attr("type", "hidden").attr("name", "fileName").attr("value", fileName));
	 form.appendTo('body').submit().remove();
}
$(function(){
	var radio = $('input:radio[name="serviceModel"]')
	radio.change( function () {
		var v = $(this).val()
		if (v === '普通销售') {
			$('#buycont').attr('readonly', 'readonly').val('')
		} else {
			$('#buycont').removeAttr('readonly').val('')
		}
	})
	$('#contractType').combobox({
		onChange: function () {
			if ($(this).val() == '框架协议') {
				$('#pact-detail').css('display','none')
				$('#dg').css('display','none')
			} else {
				$('#pact-detail').css('display','')
				$('#dg').css('display','')
			}
		}
	})
	if(!!window.ActiveXObject || "ActiveXObject" in window ||(navigator.userAgent.indexOf("Edge") > -1)){
		$.messager.alert("提示消息","当前浏览器对数据处理兼容性不是太好，建议换其他浏览器访问以保证数据的准确性。")
	}
	//客户信息赋值
	$.ajax({
		type:"get",
		url:"http://portal.aikosolar.com/aiko-crm/sapconfig/execute?functionCode=ZSDCRM005",
		cache:true,
		success:function(data){
			var data1 = [{"text": " ","id":""}]
		 	for(var i=0; i<data.data.result.length; i++){
		 		var code = data.data.result[i].code
		 		var name = data.data.result[i].name
		 		var saleorg1 = code + " " + name
		 		data1.push({"text":saleorg1,"id":saleorg1})
		 	}
		 	$("#custom1").combobox("loadData", data1)
		}
	}) 
	//获取付款条件
	$.ajax({
		 type:'get',
		 url:'http://portal.aikosolar.com/aiko-crm/sapconfig/execute?functionCode=ZSDCRM010',
		 dataType : "json", 
		 success:function(data){
		 	var data1 = [{"text": "","id":""}]
		 	for(var i=0; i<data.data.result.length; i++){
		 		var code = data.data.result[i].code
		 		var name = data.data.result[i].name
		 		var saleorg1 = code + " " + name
		 		data1.push({"text": saleorg1,"id":saleorg1})
		 	} 
		 	$("#payterm").combobox("loadData", data1)
		 }
		}) 
	//获取货币类型
	$.ajax({
		 type:'get',
		 url:'http://portal.aikosolar.com/aiko-crm/sapconfig/execute?functionCode=ZSDCRM007',
		 dataType : "json", 
		 success:function(data){
		 	var data1 = [{"text": "","id":""}]
		 	for(var i=0; i<data.data.result.length; i++){
		 		var code = data.data.result[i].code
		 		var name = data.data.result[i].name
		 		var saleorg1 = code + " " + name
		 		data1.push({"text": saleorg1,"id":saleorg1})
		 	} 
		 	$("#currencytype").combobox("loadData", data1)
		 }
		}) 
	//获取合同信息
	$.ajax({
		type: 'GET',
		url: '${ctx}/pact/showModiPact',
		dataType: 'json',
		success: function(data) {
			console.log(data)
			var arr = new Array()
			if(data.resOne!=null && data.resOne!=""){
			arr= data.resOne.split(",")
			}else{
				$("#fujian").append(`<tr id='nofj'><td>无附件</td></tr>`)
			}
			for(var i=0;i<arr.length; i++){
				var arr1 = new Array()
				arr1 = arr[i].split("\\")
				var pth = arr1[arr1.length-2]
				var filename = arr1[arr1.length-1]
				$("#fujian").append(`<tr><td><a href="#" onclick="downloadfile('${pth}','${filename}')">${filename}</a>---<input type='button' onclick='removetr()' value='删除'><input type='hidden' id='fileName' name='fileName' value="${filename}"/></td></tr>`)
			}
			$('#contractType').combobox('setValue',data.contractType)
			$('#formatcont').children().each(function () {
				if ($(this).val() === data.isformate){
					$(this).attr('checked','checked')
				}
			})
			$('#busimod').children().each(function () {
				if ($(this).val() === data.serviceModel){
					$(this).attr('checked','checked')
				}
			})
			$('#resOne').val(data.resOne)
			$('#saleorg').combobox('setValue',data.saleOrg)
			$('#saleway').combobox('setValue',data.saleWay)
			$('#salegroup').combobox('setValue',data.saleGroup)
			$('#custom1').searchbox('setValue',data.customerNo+" "+data.customerName)
			$('#buycont').textbox('setValue',data.saleFunc)
			$('#resThree').textbox('setValue',data.purchaseNo)
			$('#statime').datebox('setValue',formatDateModi(data.staTime))
			$('#endtime').datebox('setValue',formatDateModi(data.endTime))
			$('#salefunc').textbox('setValue',data.saleFunc)
			$('#contractno').val(data.contractNo)
			$('#partimes').textbox('setValue',data.period)
			$('#payway').combobox('setValue',data.paymentWay)
			$('#payterm').combobox('setValue',data.paymentTerm)
			$('#tradeterm').combobox('setValue',data.tradeTerm)
			$('#currencytype').combobox('setValue',data.currency)
			$('#employee2').combobox('setValue',data.employee)
			$('#pactId').val(data.contractId)
			$('#resTwo').textbox('setValue',data.resTwo)
			var details = data.pactItem
			for (let i = 0; i < details.length; i++) {
				var html = `<tr>
								<td><input type="checkbox" name="index" style="width: 20px; height: 20px"></td>
								<td><input type="text" name="materielNo" style="width: 30px;" readonly="readonly"></td>
								<td><select style="width: 100%; height: 25px" name="silicon"> <option value="单晶">单晶</option> <option value="多晶">多晶</option> <option value="PERC">PERC</option> <option value="${data.pactItem[i].silicon}" selected="selected">${data.pactItem[i].silicon}</option></select></td>
								<td><select style="width: 100%; height: 25px" name="mainGrid"> <option value="四主栅">四主栅</option> <option value="五主栅">五主栅</option> <option value="${data.pactItem[i].mainGrid}" selected="selected">${data.pactItem[i].mainGrid}</option></select></td>
								<td><select style="width: 100%; height: 25px" name="tech"> <option value="1">1</option> <option value="2">2</option> <option value="${data.pactItem[i].tech}" selected="selected">${data.pactItem[i].tech}</option></select></td>
								<td><input type="number" name="convertRate" style="width: 100px;" required="required" value="${data.pactItem[i].convertRate}"></td>
								<td><select style="width: 100%; height: 25px" name="grade"> <option value="A级">A级</option> <option value="B级">B级</option><option value="C级">C级</option><option value="${data.pactItem[i].grade}" selected="selected">${data.pactItem[i].grade}</option></select></td>
								<td><input type="number" name="mount" style="width: 100px;"  required="required" value="${data.pactItem[i].mount}"></td>
								<td><select style="width: 100px; height: 25px"  name="unit"> <option value="W">W</option> <option value="PC">PC</option> <option value="${data.pactItem[i].unit}" selected="selected">${data.pactItem[i].unit}</option> </select></td>
								<td><input type="number" name="unitCost" style="width: 100px;"  required="required" value="${data.pactItem[i].unitCost}"></td>
								<td><input type="number" step='0.001' name="sum" style="width: 120px;"  required="required" value="${data.pactItem[i].sum}"></td>
								<td><input type="text" name="deliveryState" style="width: 80px;" value="${data.pactItem[i].deliveryState}" readonly="readonly"></td>
								<td><input type="text" name="billState" style="width: 80px;" value="${data.pactItem[i].billState}" readonly="readonly"></td>
								<td><input type="hidden" step='0.001' name="contractDetailId" value="${data.pactItem[i].contractDetailId}"></td>
							</tr>`
				$('#dg').append(html)
			}
			for (let i = 2; i < details.length + 2; i++) {
				$("#dg tr:eq(" + i + ")").find("input[name='materielNo']").val(($(this).index() + i) * 10)
			}
		}
	});
})
//文件上传
function fileupload() {
		var s = $('#file').filebox('getValue');
		//     var req = new XMLHttpRequest();
		//     req.open("post", "${pageContext.request.contextPath}/public/testupload", false);
		//     req.send(form);
		if(s==""||s==null){
			$.messager.alert("文件提示","请选择要上传的文件")
		}else{
			var s1 = s.split("\\")
			$('#file1').val(s1[s1.length-1])
			var form = new FormData(document.getElementById("pact"))
			$.ajax({
				url : "${ctx}/test/testupload",
				type : "post",
				data : form,
				processData : false,
				contentType : false,
				success : function(data) {
					var x = path.split("\\")
					var path1 = x[x.length-2]
					if(data!="上传失败！"){
					//alert(data+'， 上传成功！')
					$.messager.alert('上传文件提示',data+'， 上传成功！');
					$("tr[id='nofj']").remove();
					$('#fujian').append(
							`<tr><td><a href="#" onclick="downloadfile('${path1}','${data}')">${data}</a><input type='hidden' id='fileName' name='fileName' value="${data}"/>---<input type='button' onclick='removetr()' value='删除'></td></tr>`)
					}
				},
				error : function(e) {
					//alert("上传失败！")
					$.messager.alert('上传文件提示',"上传失败！");
				}
			})
		}
	}
//移除行
function removetr(){
	$.messager.confirm('警告框', '确定删除?', function(r){
		if(r){
			n = $(this).parents("tr").index(); // 获取checkbox所在行的顺序
			$("#fujian").find("tr:eq(" + n + ")").remove();
		}
	})
}	

$(function(){
	$.ajax({
		type:"get",
		url:"${ctx}/pact/getSavePath",
		cache:true,
		success:function(data){
			path = data
		} 
	})
})
//提交前赋值
function fuzhi(){
	if ($("#payterm").combobox("getValue") == "") {
		$.messager.alert('提示','请选择付款条件');
		//alert("会议时间不能为空！");
		event.preventDefault();
	} else if($("#currencytype").combobox("getValue") == ""){
		$.messager.alert('提示','请选择货币类型');
		//alert("会议时间不能为空！");
		event.preventDefault();
	}else{
		var fileNames = document.getElementsByName('fileName')
		 var x =""
		 for(var i=0; i<fileNames.length-1;i++){
			 x += path+fileNames[i].value+","
		 }
		 x+= path+fileNames[fileNames.length-1].value
		 //alert(x)
		 $('#resOne').val(x)
	}
 }
 //赋值雇员信息
function getemp2(){
	$("#empt2").empty()
	//$.messager.alert($('#prono2').textbox('getValue')+$('#prona2').textbox('getValue'))
	var prono2 = $('#emp2').textbox('getValue')
	$.ajax({
		type:"get",
		url:"http://portal.aikosolar.com/aiko-crm/sapconfig/execute?functionCode=ZSDCRM008",
		cache:true,
		success:function(data){
			var index1=0;
			for(var i=0;i<data.data.result.length;i++){
				var code1 = data.data.result[i].code
				var name1 = data.data.result[i].name
				var prono = code1 + " " + name1
				if(prono.indexOf(prono2)>-1){
						index1++;
						$("#empt2").append(`<tr><td>${i+1}</td><td><a
						href='#' onclick="javascript:choseemp('${code1}','${name1}')">${code1}</a></td><td><a
						href='#' onclick="javascript:choseemp('${code1}','${name1}')">${name1}</a></td></tr>`)		
				}
			}
			if(index1==0){
				$.messager.alert("提示","无数据")
			}
		}
	}) 
}
function choseemp(prono,prona){
$("#employee").searchbox('setValue',prona)
$.messager.alert("销售雇员信息","添加成功！<br>雇员编码："+prono+'<br>雇员名称：'+prona)
}
//撤回申请
function chehui(){
	if($('#contractno').val()==""||$('#contractno').val()==null){
		$.messager.confirm("消息提示","确定要撤回吗？",function(r){
			if(r){
				$.messager.confirm("消息提示","撤回成功",function(r){
					if(r){
						location.href="${ctx}/pact/index"
					}else{
						location.href="${ctx}/pact/index"
					}
				})
			}
		})
	}else{
		$.messager.alert("消息提示","该合同已生成合同编码，暂不支持撤回！")
	}
	
}

//查看流程
function chakanlc(){
	$.messager.alert("消息提示","流程如图")
}
//赋值销售雇员信息
$.ajax({
	type:"get",
	url:"http://portal.aikosolar.com/aiko-crm/sapconfig/execute?functionCode=ZSDCRM008",
	cache:true,
	success:function(data){
		var data1 = [{"text": " ","id":""}]
	 	for(var i=0; i<data.data.result.length; i++){
	 		var code = data.data.result[i].code
	 		var name = data.data.result[i].name
	 		var saleorg1 = code + " " + name
	 		data1.push({"text":saleorg1,"id":saleorg1})
	 	}
	 	$("#employee2").combobox("loadData", data1)
	}
}) 
</script>
</head>
<body class="easyui-layout">
	<div id="result" data-options="region:'center',title:'修改合同'">
		<div style="background-color: #F0F8FF; height: 100%"
			class="easyui-panel">
		<form id="pact" action="${ctx}/contract/updateContract" onsubmit="fuzhi()" method="post">
			<input type="hidden" name="contractId" id="pactId">
			<table style="width: 100%; border-collapse: collapse;">
				<tr style="height: 10px"></tr>
				<tr>
					<td>合同类型：</td>
					<td>
					<select style="width: 180px; height: 25px"
							required="required" class="easyui-combobox" name="contractType"
							id="contractType"
							data-options="panelHeight:'auto'">
								<option>标准数量合同</option>
								<option>样片合同</option>
								<option>框架协议</option>
						</select>
					</td>
					<td width="100"></td>
					<td>格式合同：</td>
					<td id="formatcont"><input type="radio" name="isformate" value="是"
						checked="checked">是<input type="radio"
						name="isformate" value="否">否</td>
					<td width="100"></td>
					<td>业务模式：</td>
					<td id="busimod"><input type="radio" name="serviceModel" value="普通销售"
						checked="checked">普通销售<input type="radio"
						name="serviceModel" value="双经销">双经销</td>
					<td width="100"></td>
					<td>采购合同引擎：</td>
					<td><input style="width: 180px" class="easyui-textbox"
						id="buycont" name="saleFunc" type="text"
						data-options="prompt:'请输入采购合同引擎',required:false" /></td>
				</tr>
				<tr style="height: 10px"></tr>
				<tr>
					<td>销售组织：</td>
					<td><select style="width: 180px; height: 25px"
						class="easyui-combobox" id="saleorg" name="saleOrg">
							<option value="1100 爱康外贸销售">1100 爱康外贸销售</option>
								<option value="1100 广东爱旭外贸">1100 广东爱旭外贸</option>
								<option value="1200 广东爱旭内贸">1200 广东爱旭内贸</option>
								<option value="1300 广东爱旭OEM">1300 广东爱旭OEM</option>
								<option value="1400 广东爱旭其它">1400 广东爱旭其它</option>
								<option value="2100 浙江爱旭外贸">2100 浙江爱旭外贸</option>
								<option value="2200 浙江爱旭内贸">2200 浙江爱旭内贸</option>
								<option value="2300 浙江爱旭OEM">2300 浙江爱旭OEM</option>
								<option value="2400 浙江爱旭其它">2400 浙江爱旭其它</option>
					</select></td>
					<td width="100"></td>
					<td>分销渠道：</td>
					<td><select style="width: 150px; height: 25px"
						class="easyui-combobox" id="saleway"data-options="panelHeight:'auto'" name="saleWay">
							<option>10 直销</option>
							<!-- <option>20 代理</option>
							<option>30 国内</option>
							<option>40 国外</option> -->
					</select></td>
					<td width="100"></td>
					<td>销售组：</td>
					<td><select style="width: 180px; height: 25px"
						class="easyui-combobox" id="salegroup"
						 data-options="panelHeight:'auto'" name="saleGroup">
							<option>101 外贸组</option>
							<option>201 内贸组</option>
							<option>301 OEM组</option>
							<option>401 其他组</option>
					</select></td>
					<td width="100"></td>
					<td>合同编码：</td>
					<td><input
						style="width: 180px; height: 18px; background-color: #F0F8FF; border-radius: 5px;"
						id="contractno" type="text" readonly="readonly">
					</td>
				</tr>
				<tr style="height: 10px"></tr>
				<tr style="background-color: #CAE1FF; height: 30px;">
					<td colspan="11"><b>合同摘要</b></td>
				</tr>
				<tr style="height: 10px"></tr>
				<tr>
					<td>客户：</td>
					<!-- <td><input class="easyui-searchbox" id="customerName" required="required"
						data-options="prompt:'请输入客户信息',searcher:searchcus"
						style="width: 180px" name="customerName"></input></td>
						<script>
						function searchcus(){
							//openwindow("${ctx}/pact/showProNo","客户信息",600,400)
							$('#w1').window('open')
						}
						</script> -->
						<input type="hidden" name="customerNo" value="11" />
					<td><select style="width: 180px" name="customerName"
							id="custom1"
						data-options="valueField:'id', textField:'text',panelWidth:300"
							 class="easyui-combobox" ></select></td>
					<td width="100"></td>
					<td>客户采购编码：</td>
					<td><input style="width: 180px" class="easyui-textbox"
						id="resThree" type="text" required="required"
						data-options="prompt:'请输入客户采购编码',required:false" name="purchaseNo"></td>
					<td width="100"></td>
					<td>有效期从：</td>
					<td><input class="easyui-datebox" id="statime" style="width: 180px" name="staTime"></td>
					<td width="100"></td>
					<td>有效期至：</td>
					<td><input class="easyui-datebox" id="endtime" style="width: 180px" name="endTime"></td>
				</tr>
				<tr style="height: 10px"></tr>
				<tr>
					<!-- <td>销售方式：</td>
					<td><input style="width: 180px" class="easyui-textbox"
						id="salefunc" name="saleFunc" type="text" required="required"
						data-options="prompt:'请输入销售方式',required:false" /></td> -->
					<td>付款方式：</td>
					<td><select style="width: 180px; height: 25px"
						class="easyui-combobox" id="payway" panelMaxHeight="200px" 
							data-options="panelHeight:'auto'" name="paymentWay">
							<option value="1 3个月银行承兑汇票">1 3个月银行承兑汇票</option>
							<option value="2 120天国内信用证">2 120天国内信用证</option>
							<option value="3 硅片电池片金额抵冲">3 硅片电池片金额抵冲</option>
							<option value="A 6个月银行承兑汇票">A 6个月银行承兑汇票</option>
							<option value="B Bill of exchange (bank)">B Bill of exchange (bank)</option>
							<option value="C 支票">C 支票</option>
							<option value="D 6个月信用证">D 6个月信用证</option>
							<option value="E 现金">E 现金</option>
							<option value="G 3个月信用证">G 3个月信用证</option>
							<option value="I 45天信用证">I 45天信用证</option>
							<option value="T 电汇（Bank transfer）">T 电汇（Bank transfer）</option>
							<option value="U 电汇（Transfer）">U 电汇（Transfer）</option>
					</select></td>
					<td width="100"></td>
					<td>付款条件：</td>
					<td>
					<select style="width: 180px; height: 25px"
							 name="paymentTerm" class="easyui-combobox"
							data-options="valueField:'id', textField:'text'"
							id="payterm">
						</select>
					</td>
					<td width="100"></td>
					<td>贸易条款：</td>
					<td><select style="width: 180px; height: 25px"
							data-options="panelHeight:'auto'"
						class="easyui-combobox" id="tradeterm" name="tradeTerm">
							<option value="CB1 保险">CB1 保险</option>
							<option value="CY1 运费-鼎天">CY1 运费-鼎天</option>
							<option value="CY2 运费-DHL">CY2 运费-DHL</option>
							<option value="CY3 运费-新邦">CY3 运费-新邦</option>
							<option value="CY4 运费-FEDEX">CY4 运费-FEDEX</option>
							<option value="CY5 运费-盛达">CY5 运费-盛达</option>
							<option value="CY6 运费-跨越">CY6 运费-跨越</option>
							<option value="CY7 运费-顺丰">CY7 运费-顺丰</option>
					</select></td>
					<td width="100"></td>
					<td>货币类型：</td>
					<td><select style="width: 180px; height: 25px"
					data-options="valueField:'id', textField:'text'"
						class="easyui-combobox" id="currencytype" name="currency">
					</select></td>
					<!-- <td>分期数：</td>
					<td><input style="width: 180px" class="easyui-textbox"
						id="partimes" name="period" type="text" required="required"
						data-options="prompt:'请输入分期数',required:false" /></td> -->
				</tr>
				<tr style="height: 10px"></tr>
				<tr>
					<!-- <td>贸易条款：</td>
					<td><select style="width: 180px; height: 25px"
							data-options="panelHeight:'auto'"
						class="easyui-combobox" id="tradeterm" name="tradeTerm">
							<option value="CB1 保险">CB1 保险</option>
							<option value="CY1 运费-鼎天">CY1 运费-鼎天</option>
							<option value="CY2 运费-DHL">CY2 运费-DHL</option>
							<option value="CY3 运费-新邦">CY3 运费-新邦</option>
							<option value="CY4 运费-FEDEX">CY4 运费-FEDEX</option>
							<option value="CY5 运费-盛达">CY5 运费-盛达</option>
							<option value="CY6 运费-跨越">CY6 运费-跨越</option>
							<option value="CY7 运费-顺丰">CY7 运费-顺丰</option>
					</select></td>
					<td width="100"></td>
					<td>货币类型：</td>
					<td><select style="width: 180px; height: 25px"
					data-options="valueField:'id', textField:'text'"
						class="easyui-combobox" id="currencytype" name="currency">
					</select></td>
					<td width="100"></td> -->
					<td>销售雇员：</td>
					<!-- <td><input class="easyui-searchbox" id="employee" name="employee"
						data-options="prompt:'请输入销售雇员信息',searcher:searchemp" required="required"
						style="width: 180px"></input></td> -->
					<td>
					<select style="width: 180px" id="employee2" name="employee"
						data-options="valueField:'id', textField:'text',panelWidth:180,required:true"
							 class="easyui-combobox" ></select>
					</td>
					<td width="100"></td>
					<!-- <script>
						function searchemp(){
							//openwindow("${ctx}/pact/showProNo","客户信息",600,400)
							$('#w2').window('open')
						}
					</script> -->
				</tr>
				<tr style="height: 10px"></tr>
				<tr style="background-color: #CAE1FF; height: 30px;">
					<td colspan="11"><b>合同 标的</b></td>
				</tr>
			</table>
			<table id="dg" style="text-align: center; width: 100%">
					<tr style="text-align:left;">
						<td colspan="5"><a href="javascript:void(0)"
							class="easyui-linkbutton"
							data-options="iconCls:'icon-add',plain:true" onclick="appendtr()">新增</a>
							<a href="javascript:void(0)" class="easyui-linkbutton"
							data-options="iconCls:'icon-remove',plain:true"
							onclick="removeit()">删除</a><a href="javascript:void(0)" class="easyui-linkbutton"
				data-options="iconCls:'icon-search',plain:true" style="width: 100px;height:30px"
				onclick="queplan()">交货计划</a></td>
					</tr>
					<tr style="width: 100%">
						<th style="text-align: center; width: 3%">选择</th>
						<th style="text-align: center; width: 3%">项目</th>
						<th style="text-align: center; width: 10%">硅片晶体</th>
						<th style="text-align: center; width: 10%">主珊</th>
						<th style="text-align: center; width: 10%">工艺</th>
						<th style="text-align: center; width: 5%">转换率（%）</th>
						<th style="text-align: center; width: 5%">等级</th>
						<th style="text-align: center; width: 10%">数量</th>
						<th style="text-align: center; width: 10%">单位</th>
						<th style="text-align: center; width: 10%">单价</th>
						<th style="text-align: center; width: 10%">金额</th>
						<th style="text-align: center; width: 10%">交货状态</th>
						<th style="text-align: center; width: 10%">发票状态</th>
					</tr>
			</table>
			<table style="width:100%">
				<tr style="background-color: #CAE1FF; height: 30px;">
					<td colspan="11"><b>交货计划</b></td>
				</tr>
			</table>
			<table id="dg1" style="text-align: center; width: 100%">
					<tr style="text-align: left;">
						<td colspan="5"><a href="javascript:void(0)"
							class="easyui-linkbutton"
							data-options="iconCls:'icon-add',plain:true" onclick="appendtr1()">新增</a>
							<a href="javascript:void(0)" class="easyui-linkbutton"
							data-options="iconCls:'icon-remove',plain:true"
							onclick="removeit1()">删除</a></td>
					</tr>
					<tr style="width: 100%">
						<th style="text-align: center; width: 3%">选择</th>
						<th style="text-align: center; width: 5%">合同项目	</th>
						<th style="text-align: center; width: 4%">计划号</th>
						<th style="text-align: center; width: 10%">计划日期</th>
						<th style="text-align: center; width: 10%">物料编码</th>
						<th style="text-align: center; width: 10%">物料描述</th>
						<th style="text-align: center; width: 10%">数量</th>
						<th style="text-align: center; width: 10%">单位</th>
						<th style="text-align: center; width: 10%">单价</th>
						<th style="text-align: center; width: 10%">金额</th>
						<th style="text-align: center; width: 10%">销售订单</th>
						<th style="text-align: center; width: 10%">交货单</th>
					</tr>
			</table>
			<table style="width: 100%">
				<tr style="background-color: #CAE1FF; height: 30px;">
					<td colspan="11"><b>补充/变更摘要</b></td>
				</tr>
				<tr>
					<td><input class="easyui-textbox" name="resTwo" id="resTwo"
						data-options="multiline:true" style="height: 60px; width: 100%;"></input></td>
				</tr>
			</table>
			<table id='fujian' style="width: 100%;">
				<tr style="background-color: #CAE1FF; height: 30px;">
					<td colspan="11"><b>附件上传</b></td>
				</tr>
				<tr>
						<td><input class="easyui-filebox" name="file" id="file"
							data-options="prompt:'请选择文件。。。',buttonText: '选择文件'"> <input type="button"
							value="上传" style="width:60px;height:35px;background-color:#FFA500;border-radius:5px" onclick="fileupload()"></td>
				</tr>
			</table>
			<table style="width: 100%;">
				<tr style="background-color: #CAE1FF; height: 30px;">
					<td colspan="11"><center>
							<input style="width: 60px; height: 35px; border-radius: 5px;"
									type="submit" value="提交">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input
									style="width: 80px; height: 35px; border-radius: 5px;"
									onclick="chakanlc()" type="button" value="查看流程">
									&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input
									style="width: 60px; height: 35px; border-radius: 5px;"
									onclick="chehui()" type="button" value="撤回">
						</center></td>
			</table>
			<input type="hidden" name="file1" id="file1"/>
		<input type="hidden" id="resOne" name="resOne"/>
			</form>
		</div>
	</div>
	<div id="w1" class="easyui-window" title="客户信息" data-options="modal:true,closed:true,iconCls:'icon-save'" style="width:550px;height:300px;">
		客户信息：<input style="width: 200px" class="easyui-textbox"
							id="cus2" type="text"
							data-options="prompt:'输入客户信息（编码或名称）',required:false" />
		<a href="javascript:void(0)" class="easyui-linkbutton"
				data-options="iconCls:'icon-search'" style="width: 80px"
				onclick="getcus()">获取数据</a>
		<table id="cust2"></table>
	</div>
	<div id="w2" class="easyui-window" title="销售雇员信息" data-options="modal:true,closed:true,iconCls:'icon-save'" style="width:550px;height:300px;">
		雇员信息：<input style="width: 200px" class="easyui-textbox"
							id="emp2" type="text"
							data-options="prompt:'输入雇员信息（编码或名称）',required:false" />
		<a href="javascript:void(0)" class="easyui-linkbutton"
				data-options="iconCls:'icon-search'" style="width: 80px"
				onclick="getemp2()">获取数据</a>
		<table id="empt2"></table>
	</div>
</body>

</html>